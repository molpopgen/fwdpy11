
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Soft selection with discrete demes &#8212; fwdpy11 manual</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Different effect sizes of mutations in different demes" href="mvdes.html" />
    <link rel="prev" title="Advanced topics" href="advancedtopics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">fwdpy11 manual</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Installation and setup
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="userenv.html">
   Setting up user environments for installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="deploymenttools.html">
   Deployment tools
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Short vignettes - operations on populations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/initpops_vignette.html">
   Initializing a population
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/poptour_vignette.html">
   Properties of populations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Short vignettes - setting up the genetics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/genetics_vignettes_intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/geneticmaps_vignette.html">
   Genetic maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/des_vignette.html">
   Distributions of effect sizes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/mutationdominance_vignette.html">
   Mutations with variable dominance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/neutralmuts_vignette.html">
   Neutral mutations during a simulation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/gvalues_fitness.html">
   Genetic values - mutations with direct effects on fitness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/gvalues_traits.html">
   Genetic values - simulating phenotypes/traits.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/workingexample_fitness.html">
   Working example - parameters for simulating direct effects on fitness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/workingexample_trait.html">
   Working example - parameters for the simulation of a trait
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Short vignettes - simulation with tree sequence recording
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/evolvets_vignette.html">
   Evolving with tree sequence recording
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/recorders_vignette.html">
   Recording data during a simulation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/recapitation.html">
   Finishing a simulation with msprime
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/neutralmutsafter_vignette.html">
   Adding neutral mutations to a population with existing ancestry
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Short vignettes - demographic modeling
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/demography_vignettes_intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/demes_vignette.html">
   Using
   <code class="docutils literal notranslate">
    <span class="pre">
     demes
    </span>
   </code>
   to specify demographic models.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/demography_debugger_vignette.html">
   Debugging demographic models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Short vignettes - varying fitness conditions across demes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/varying_fitness_conditions_across_demes_intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/multivariate_gaussian_effect_sizes_across_demes.html">
   The multivariate Gaussian distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/multivariate_lognormal_effect_sizes.html">
   The multivariate lognormal distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/custom_multivarate_distributions.html">
   “Custom” multivariate distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/special_considerations_demes_models.html">
   Special considerations for demes models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Short vignettes - conditional models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/trackmutationfates.html">
   Tracking user-specified new mutations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/selective_sweep.html">
   Selective sweeps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../short_vignettes/incomplete_sweep.html">
   Incomplete selective sweeps
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Longer vignettes - exporting data to tskit
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../long_vignettes/tskitconvert_vignette.html">
   Converting data to tskit format
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../long_vignettes/tskit_metadata_vignette.html">
   Working with data in tskit format
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Longer vignettes - complete examples
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../long_vignettes/import_mutations_from_tskit.html">
   Importing mutations from tskit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../long_vignettes/bgs_vignette.html">
   Background selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../long_vignettes/gss_vignette.html">
   Gaussian stabilizing selection with an optimum shift
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../long_vignettes/pyfreqtracker.html">
   Tracking mutations over time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../long_vignettes/pyfreqtracker_sqlite.html">
   Tracking mutations over time using
   <code class="docutils literal notranslate">
    <span class="pre">
     sqlite3
    </span>
   </code>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Concepts
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="definitions.html">
   Definitions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="tutorial.html">
   Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="advancedtopics.html">
   Advanced topics
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Objects and concepts
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Soft selection with discrete demes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mvdes.html">
   Different effect sizes of mutations in different demes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tsoverview.html">
   Conceptual overview of tree sequence recording
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tstypes.html">
   Data structures related to tree sequences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tablefs.html">
   Calculating frequency spectra from tree sequences
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="recorders.html">
   Time series analysis
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Technical details
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../technical/demes.html">
   Details of
   <code class="docutils literal notranslate">
    <span class="pre">
     demes
    </span>
   </code>
   integration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../technical/genetic_values.html">
   Technical overview of genetic value calculations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../technical/writingplugins.html">
   Writing “plugins” with C++
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data types and fuctions
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="genetic_values.html">
   Genetic values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="datamatrix.html">
   DataMatrix and StateMatrix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="demographic_models.html">
   The demography debugger
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="functions.html">
   Function documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gslrandom.html">
   Random number distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gvaluenoise.html">
   Adding random noise to genetic values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gvalue_to_fitness.html">
   Mapping genetic values to fitness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model_params.html">
   Model parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regiontypes.html">
   Setting up genomic intervals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tskit_tools.html">
   Module
   <code class="docutils literal notranslate">
    <span class="pre">
     fwdpy11.tskit_tools
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conditional_models.html">
   Module
   <code class="docutils literal notranslate">
    <span class="pre">
     fwdpy11.conditional_models
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="types.html">
   Data types related to simulated populations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Examples
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/gss_divergent_optima.html">
   Adaptation to different optima with multivariate distribution of effect sizes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/IM.html">
   Isolation-with-migration (IM)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/localadaptation.html">
   Local adaptation of a quantitative trait
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/migtest.html">
   Symmetric migration between two demes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/pysnowdrift.html">
   Snowdrift model in python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/recorder.html">
   Example of time series analysis implemented in C++
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Miscellany
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/changelog.html">
   Changelog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/deprecated.html">
   Deprecated features
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/developersguide.html">
   Developer’s guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/pubs.html">
   Publications using fwdpy11
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/upgrade_path.html">
   Upgrade path
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/bibliography.html">
   Literature cited
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/molpopgen/fwdpy11"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/molpopgen/fwdpy11/issues/new?title=Issue%20on%20page%20%2Fpages/softselection.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/pages/softselection.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/pages/softselection.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-model">
     The model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-timings-of-events">
     The timings of events
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-the-initial-demes-in-a-simulation">
   Setting the initial demes in a simulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-discretedemography-class">
   The DiscreteDemography class
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compatibility-with-previous-versions-of-fwdpy11">
     Compatibility with previous versions of fwdpy11
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#event-types">
   Event types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mass-migrations">
     Mass migrations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-the-initial-state-of-a-simulation">
       Setting the initial state of a simulation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-mass-migrations">
       Multiple mass migrations
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-rate-of-drift">
       The rate of drift
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#instantaneous-deme-size-changes">
     Instantaneous deme size changes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-growth-rates">
     Changing growth rates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-the-selfing-rate">
     Changing the selfing rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#migration">
     Migration
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#an-alternative-model-of-migration">
       An alternative model of migration
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples-of-models">
   Examples of models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#isolation-with-migration-or-im">
     Isolation with migration, or “IM”
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Soft selection with discrete demes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-model">
     The model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-timings-of-events">
     The timings of events
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-the-initial-demes-in-a-simulation">
   Setting the initial demes in a simulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-discretedemography-class">
   The DiscreteDemography class
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compatibility-with-previous-versions-of-fwdpy11">
     Compatibility with previous versions of fwdpy11
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#event-types">
   Event types
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mass-migrations">
     Mass migrations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#setting-the-initial-state-of-a-simulation">
       Setting the initial state of a simulation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#multiple-mass-migrations">
       Multiple mass migrations
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-rate-of-drift">
       The rate of drift
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#instantaneous-deme-size-changes">
     Instantaneous deme size changes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-growth-rates">
     Changing growth rates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-the-selfing-rate">
     Changing the selfing rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#migration">
     Migration
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#an-alternative-model-of-migration">
       An alternative model of migration
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples-of-models">
   Examples of models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#isolation-with-migration-or-im">
     Isolation with migration, or “IM”
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="soft-selection-with-discrete-demes">
<span id="softselection"></span><h1>Soft selection with discrete demes<a class="headerlink" href="#soft-selection-with-discrete-demes" title="Permalink to this headline">#</a></h1>
<p>This page describes implementing models of demographic events affecting
multiple demes.  This functionality was first released in version 0.6.0
and makes use of low-level types added in 0.5.3.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h2>
<p>This chapter describes how to generate detailed demographic models of individuals
evolving withing discrete sub-populations, or demes.</p>
<p>If you want to skip the details and see basic models provided by <code class="docutils literal notranslate"><span class="pre">fwdpy11</span></code>, then
see <a class="reference internal" href="demographic_models.html#demographic-models"><span class="std std-ref">The demography debugger</span></a>.</p>
<p>Once you’ve digested this section, you may want to read <a class="reference internal" href="mvdes.html#mvdes"><span class="std std-ref">Different effect sizes of mutations in different demes</span></a>.</p>
<section id="the-model">
<h3>The model<a class="headerlink" href="#the-model" title="Permalink to this headline">#</a></h3>
<p>The model here is soft selection <span id="id1">[<a class="reference internal" href="../misc/bibliography.html#id14" title="Howard Levene. Genetic equilibrium when more than one ecological niche is available. Am. Nat., 87(836):331–333, September 1953. doi:10.1086/281792.">Lev53</a>]</span>, meaning that the number of
breeding individuals (“adults”) in each deme is fixed at a certain value.
A nice overview of this model and how it compares to others in <span id="id2">[<a class="reference internal" href="../misc/bibliography.html#id15" title="J Felsenstein. The theoretical population genetics of variable selection and migration. Annu. Rev. Genet., 10:253–280, 1976. doi:10.1146/annurev.ge.10.120176.001345.">Fel76</a>]</span>.
You may also find <span id="id3">[<a class="reference internal" href="../misc/bibliography.html#id11" title="Freddy Bugge Christiansen. Sufficient conditions for protected polymorphism in a subdivided population. Am. Nat., 108(960):157–166, 1974. doi:10.1086/282896.">Chr74</a>]</span> and <span id="id4">[<a class="reference internal" href="../misc/bibliography.html#id12" title="Freddy Bugge Christiansen. Hard and soft selection in a subdivided population. Am. Nat., 109(965):11–16, January 1975. doi:10.1086/282970.">Chr75</a>]</span> useful.</p>
<p>Each generation, we generate offspring (“juveniles”) in each deme.  In the absence of
migration, all parents of all offspring come from the offspring deme.  With a migration
matrix, we first choose the “source” deme, pick parents from that deme, and then
create the offspring in the offspring deme.  Thus, we are modeling juvenile migration.
Selfing is a property of demes and is applied to parents: we choose a parental deme,
then choose a parent, and then decide if that parent selfs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The migration behavior changed in 0.6.2!  (This is mainly a note for
the developers.)</p>
</div>
</section>
<section id="the-timings-of-events">
<h3>The timings of events<a class="headerlink" href="#the-timings-of-events" title="Permalink to this headline">#</a></h3>
<p>Below, we discuss various events that may happen.  These event types
include things like deme size changes, “mass migration” events, etc..
These events will occur at a certain time in a simulation. That time
refers to the birth time of a generation and the events are applied
<em>prior</em> to generating offspring, meaning that the events happen <em>to
the parents</em>.  For example, if half of deme zero moves and colonizes
a new deme (deme 1), then that means that half of the current alive individuals
(possible parents) have their <code class="docutils literal notranslate"><span class="pre">deme</span></code> field changed from zero to one
prior to generating any offspring.</p>
<p>The objects events all have an attribute called <code class="docutils literal notranslate"><span class="pre">when</span></code>, which
parameterizes when the event occurs in a simulation.  The value of <code class="docutils literal notranslate"><span class="pre">when</span></code>
is with respect to the current generation time of the population
(<a class="reference internal" href="types.html#fwdpy11.DiploidPopulation.generation" title="fwdpy11.DiploidPopulation.generation"><code class="xref py py-attr docutils literal notranslate"><span class="pre">fwdpy11.DiploidPopulation.generation</span></code></a>). When events are registered
to occur prior to this time, you will see warnings.  See <a class="reference internal" href="functions.html#fwdpy11.evolvets" title="fwdpy11.evolvets"><code class="xref py py-func docutils literal notranslate"><span class="pre">fwdpy11.evolvets()</span></code></a>
for details.</p>
<p>Events scheduled for prior than the population’s current time are allowed
because there are valid modeling reasons to allow them.  For example, you
may want to evolve for a while and then change some other model parameter
like the recombination rate, and then keep evolving.</p>
</section>
</section>
<section id="setting-the-initial-demes-in-a-simulation">
<span id="soft-sel-deme-setup"></span><h2>Setting the initial demes in a simulation<a class="headerlink" href="#setting-the-initial-demes-in-a-simulation" title="Permalink to this headline">#</a></h2>
<p>At the start of a simulation, you may assign diploids to demes
when constructing an instance of <a class="reference internal" href="types.html#fwdpy11.DiploidPopulation" title="fwdpy11.DiploidPopulation"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.DiploidPopulation</span></code></a>.
For example, to initialize a population with 25 individuals in demes <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import fwdpy11
import numpy as np

pop = fwdpy11.DiploidPopulation([25, 25], 1.0)
md = np.array(pop.diploid_metadata, copy=False)
pop.deme_sizes()
for m in pop.diploid_metadata:
    for n in m.nodes:
        assert m.deme == pop.tables.nodes[n].deme
</pre></div>
</div>
</div>
</div>
<p>Another method involves mass migration events at the beginning of a simulation.
See <a class="reference internal" href="#massmigrations"><span class="std std-ref">Mass migrations</span></a>.</p>
</section>
<section id="the-discretedemography-class">
<h2>The DiscreteDemography class<a class="headerlink" href="#the-discretedemography-class" title="Permalink to this headline">#</a></h2>
<p>The demographic events are stored in instances of <a class="reference internal" href="types.html#fwdpy11.DiscreteDemography" title="fwdpy11.DiscreteDemography"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.DiscreteDemography</span></code></a>.
These events, whose interface is described below, are passed in <code class="docutils literal notranslate"><span class="pre">list</span></code> objects
when creating a <a class="reference internal" href="types.html#fwdpy11.DiscreteDemography" title="fwdpy11.DiscreteDemography"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.DiscreteDemography</span></code></a> instance.</p>
<p>These instances may be used to parameterize the <code class="docutils literal notranslate"><span class="pre">demography</span></code> field of a
<a class="reference internal" href="model_params.html#fwdpy11.ModelParams" title="fwdpy11.ModelParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.ModelParams</span></code></a> instance.  To illustrate this, here is a
function that we’ll use repeatedly below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def setup_and_run_model(pop, ddemog, simlen, recorder=None, seed=654321):
    pdict = {
        &quot;nregions&quot;: [],
        &quot;sregions&quot;: [],
        &quot;recregions&quot;: [],
        &quot;rates&quot;: (
            0,
            0,
            0,
        ),
        &quot;gvalue&quot;: fwdpy11.Multiplicative(2.0),
        &quot;demography&quot;: ddemog,
        &quot;simlen&quot;: simlen,
    }
    params = fwdpy11.ModelParams(**pdict)
    rng = fwdpy11.GSLrng(seed)
    fwdpy11.evolvets(rng, pop, params, 100, recorder)
</pre></div>
</div>
</div>
</div>
<p>We will also define a simple class to record all deme sizes over time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class SizeTracker(object):
    def __init__(self):
        self.data = []

    def __call__(self, pop, sampler):
        self.data.append((pop.generation, pop.N, pop.deme_sizes()))
</pre></div>
</div>
</div>
</div>
<section id="compatibility-with-previous-versions-of-fwdpy11">
<h3>Compatibility with previous versions of fwdpy11<a class="headerlink" href="#compatibility-with-previous-versions-of-fwdpy11" title="Permalink to this headline">#</a></h3>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.8.0: </span>You now must specify <code class="docutils literal notranslate"><span class="pre">simlen</span></code> manually.</p>
</div>
<p>Previous versions only supported size changes within a single deme.  These size changes were
parameterized via a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array specifying the size at each time point.  It is still possible
to specify the demography using that approach:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>N = np.array([10] * 10 + [5] * 5 + [10] * 10, dtype=np.uint32)
pdict = {
   &quot;nregions&quot;: [],
   &quot;sregions&quot;: [],
   &quot;recregions&quot;: [],
   &quot;rates&quot;: (
       0,
       0,
       0,
   ),
   &quot;gvalue&quot;: fwdpy11.Multiplicative(2.0),
   &quot;demography&quot;: fwdpy11.DiscreteDemography(set_deme_sizes=N),
   &quot;simlen&quot;: len(N),
}
params = fwdpy11.ModelParams(**pdict)
rng = fwdpy11.GSLrng(654321)
pop = fwdpy11.DiploidPopulation(10, 1.0)
fwdpy11.evolvets(rng, pop, params, 100)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="event-types">
<h2>Event types<a class="headerlink" href="#event-types" title="Permalink to this headline">#</a></h2>
<p>The following sub-sections describe the various types of demographic
events allowed during a simulation.</p>
<section id="mass-migrations">
<span id="massmigrations"></span><h3>Mass migrations<a class="headerlink" href="#mass-migrations" title="Permalink to this headline">#</a></h3>
<p>Mass migration events represent the “bulk” movement of individuals
in a single generation.  Such events allow you to model population
splits, merges, etc..</p>
<p>These events are represented by instances
of <a class="reference internal" href="types.html#fwdpy11.MassMigration" title="fwdpy11.MassMigration"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.MassMigration</span></code></a>.  Currently, you create instances
of this type using one of the following two functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="types.html#fwdpy11.copy_individuals" title="fwdpy11.copy_individuals"><code class="xref py py-func docutils literal notranslate"><span class="pre">fwdpy11.copy_individuals()</span></code></a></p></li>
<li><p><a class="reference internal" href="types.html#fwdpy11.move_individuals" title="fwdpy11.move_individuals"><code class="xref py py-func docutils literal notranslate"><span class="pre">fwdpy11.move_individuals()</span></code></a></p></li>
</ul>
<p>As the name implies, the first function creates an event that <em>copies</em>
individuals from a source deme to a destination.  The latter <em>moves</em>
them.</p>
<p>Both functions take five arguments, which may be used either named
or unnamed.  In order, they are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">when</span></code>: the time (generation) when the event will occur</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code>: the ID of the source deme</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">destination</span></code>: the ID of the destination deme</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fraction</span></code>: the fraction (proportion) of <code class="docutils literal notranslate"><span class="pre">source</span></code> moved/copied to <code class="docutils literal notranslate"><span class="pre">dest</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resets_growth_rate</span></code>: If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the event resets the growth rate to <a class="reference internal" href="types.html#fwdpy11.NOGROWTH" title="fwdpy11.NOGROWTH"><code class="xref py py-attr docutils literal notranslate"><span class="pre">fwdpy11.NOGROWTH</span></code></a>
in <strong>both</strong> <code class="docutils literal notranslate"><span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">dest</span></code>. If <code class="docutils literal notranslate"><span class="pre">False</span></code>, growth rates remain unchanged.
The default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When a mass migration event <em>copies</em> individuals from deme,
the individuals copied are sampled <em>without replacement</em>.  Thus,
if the fraction copied is 1.0, then every individual is copied.</p>
</div>
<p>These operations act on proportions of populations rather than on numbers
of individuals. Multiple events in a single generation are allowed, see
<a class="reference internal" href="#multiple-mass-migrations"><span class="std std-ref">Multiple mass migrations</span></a>.</p>
<section id="setting-the-initial-state-of-a-simulation">
<h4>Setting the initial state of a simulation<a class="headerlink" href="#setting-the-initial-state-of-a-simulation" title="Permalink to this headline">#</a></h4>
<p>Let’s look at an example where we use mass migration events to set up
“who is where” at the start of a simulation.  Since events happen in
the <em>parental</em> generation, we can use mass migrations to set up
what demes individuals are in by applying events at generation 0.</p>
<p>The main difference between this method and that shown in
<a class="reference internal" href="#soft-sel-deme-setup"><span class="std std-ref">Setting the initial demes in a simulation</span></a> is that these events move or copy <em>random</em>
individuals to new demes whereas using the  <code class="docutils literal notranslate"><span class="pre">__init__</span></code> approach
builds the individuals in each deme sequentially.</p>
<p>For example, if we wish to start a simulation with 50 individuals in
demes 0 and 50 in deme 1, we have two options:</p>
<ol class="simple">
<li><p>Start with 50 individuals and <em>copy</em> them to deme 1 in generation 0</p></li>
<li><p>Start with 100 individuals and <em>move half of</em> them to deme 1 in generation 0</p></li>
</ol>
<p>Here is the version implemented via a  copy:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation(50, 1.0)
copy = [fwdpy11.copy_individuals(when=0, source=0, destination=1, fraction=1.0)]
ddemog = fwdpy11.DiscreteDemography(mass_migrations=copy)
setup_and_run_model(pop, ddemog, 1)
pop.deme_sizes()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([0, 1], dtype=int32), array([50, 50]))
</pre></div>
</div>
</div>
</div>
<p>Here is what our object looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>copy[0]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fwdpy11.MassMigration(when=0, source=0, destination=1, fraction=1.0, move_individuals=False, resets_growth_rate=True)
</pre></div>
</div>
</div>
</div>
<p>Here is the version using a move:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation(100, 1.0)
move = [fwdpy11.move_individuals(0, 0, 1, 0.5)]
ddemog = fwdpy11.DiscreteDemography(mass_migrations=move)
setup_and_run_model(pop, ddemog, 1)
pop.deme_sizes()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([0, 1], dtype=int32), array([50, 50]))
</pre></div>
</div>
</div>
</div>
<p>For comparison, here is the object specifying the move:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>move[0]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fwdpy11.MassMigration(when=0, source=0, destination=1, fraction=0.5, move_individuals=True, resets_growth_rate=True)
</pre></div>
</div>
</div>
</div>
</section>
<section id="multiple-mass-migrations">
<span id="id5"></span><h4>Multiple mass migrations<a class="headerlink" href="#multiple-mass-migrations" title="Permalink to this headline">#</a></h4>
<p>To specify multiple events, simply add more events to your list.
The events to not have to be sorted in any specific way.  Any sorting
requirements get handled internally.</p>
<p>Multiple events involving the same source population in the same generation
need some explaining.   If the events are copies, things will tend to “just
work”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation(50, 1.0)
copy = [fwdpy11.copy_individuals(0, 0, 1, 1.0), fwdpy11.copy_individuals(0, 0, 2, 1.0)]
ddemog = fwdpy11.DiscreteDemography(mass_migrations=copy)
setup_and_run_model(pop, ddemog, 1)
pop.deme_sizes()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([0, 1, 2], dtype=int32), array([50, 50, 50]))
</pre></div>
</div>
</div>
</div>
<p>When the events are moves, it is not possible to move more than 100%
of the individuals.  Attempting to do so will raise a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>
exception:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation(50, 1.0)
# Move all of deme 0 into demes 1 and 2,
# which means we&#39;re trying to move 200%
# of deme 0...
move = [fwdpy11.move_individuals(0, 0, 1, 1.0), fwdpy11.move_individuals(0, 0, 2, 1.0)]
# ... which is not allowed
try:
    ddemog = fwdpy11.DiscreteDemography(mass_migrations=move)
except ValueError as e:
    print(e)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DiscreteDemography: at time 0, attempting to move 200% of deme 0 is invalid
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-rate-of-drift">
<h4>The rate of drift<a class="headerlink" href="#the-rate-of-drift" title="Permalink to this headline">#</a></h4>
<p>Moving versus copying individuals is an important modeling choice.
When you move individuals from one deme to another, the rate of drift
changes in the source deme (as its size is reduced).  This reduction
in size is also a sudden bottleneck.</p>
<p>Copying, on the other hand, does not change the rate of drift in the source
deme.  However, it does seem to imply some sudden increase in fecundity that
both came from nowhere and was short-lived.</p>
</section>
</section>
<section id="instantaneous-deme-size-changes">
<span id="set-deme-sizes"></span><h3>Instantaneous deme size changes<a class="headerlink" href="#instantaneous-deme-size-changes" title="Permalink to this headline">#</a></h3>
<p>Instantaneous changes in deme size are managed by instances of
<a class="reference internal" href="types.html#fwdpy11.SetDemeSize" title="fwdpy11.SetDemeSize"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.SetDemeSize</span></code></a>.</p>
<p>This class is relatively straightforward to use, so let’s dive right in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation([20, 20], 1.0)
dd = fwdpy11.DiscreteDemography(
    set_deme_sizes=[fwdpy11.SetDemeSize(when=5, deme=1, new_size=100)]
)
st = SizeTracker()
setup_and_run_model(pop, dd, 10, st)
for i in st.data:
    print(i)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1, 40, (array([0, 1], dtype=int32), array([20, 20])))
(2, 40, (array([0, 1], dtype=int32), array([20, 20])))
(3, 40, (array([0, 1], dtype=int32), array([20, 20])))
(4, 40, (array([0, 1], dtype=int32), array([20, 20])))
(5, 40, (array([0, 1], dtype=int32), array([20, 20])))
(6, 120, (array([0, 1], dtype=int32), array([ 20, 100])))
(7, 120, (array([0, 1], dtype=int32), array([ 20, 100])))
(8, 120, (array([0, 1], dtype=int32), array([ 20, 100])))
(9, 120, (array([0, 1], dtype=int32), array([ 20, 100])))
(10, 120, (array([0, 1], dtype=int32), array([ 20, 100])))
</pre></div>
</div>
</div>
</div>
<p>You may also kill off demes by setting their size to zero:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation([20, 20, 20], 1.0)
dd = fwdpy11.DiscreteDemography(
    set_deme_sizes=[fwdpy11.SetDemeSize(when=5, deme=1, new_size=0)]
)
st = SizeTracker()
setup_and_run_model(pop, dd, 6, st)
for i in st.data:
    print(i)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1, 60, (array([0, 1, 2], dtype=int32), array([20, 20, 20])))
(2, 60, (array([0, 1, 2], dtype=int32), array([20, 20, 20])))
(3, 60, (array([0, 1, 2], dtype=int32), array([20, 20, 20])))
(4, 60, (array([0, 1, 2], dtype=int32), array([20, 20, 20])))
(5, 60, (array([0, 1, 2], dtype=int32), array([20, 20, 20])))
(6, 40, (array([0, 2], dtype=int32), array([20, 20])))
</pre></div>
</div>
</div>
</div>
</section>
<section id="changing-growth-rates">
<h3>Changing growth rates<a class="headerlink" href="#changing-growth-rates" title="Permalink to this headline">#</a></h3>
<p>Instances of <a class="reference internal" href="types.html#fwdpy11.SetExponentialGrowth" title="fwdpy11.SetExponentialGrowth"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.SetExponentialGrowth</span></code></a> manage the exponential growth rates per deme.
Growth rates less than one indicate population decline, greater than one means growth
and <a class="reference internal" href="types.html#fwdpy11.NOGROWTH" title="fwdpy11.NOGROWTH"><code class="xref py py-attr docutils literal notranslate"><span class="pre">fwdpy11.NOGROWTH</span></code></a> is equal to 1.0 to indicate no growth.</p>
<p>Let’s look at an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation([50], 1.0)
g = [fwdpy11.SetExponentialGrowth(when=0, deme=0, G=1.1)]
dd = fwdpy11.DiscreteDemography(set_growth_rates=g)
st = SizeTracker()
setup_and_run_model(pop, dd, 6, st)
for i in st.data:
    print(i)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1, 55, (array([0], dtype=int32), array([55])))
(2, 61, (array([0], dtype=int32), array([61])))
(3, 67, (array([0], dtype=int32), array([67])))
(4, 73, (array([0], dtype=int32), array([73])))
(5, 81, (array([0], dtype=int32), array([81])))
(6, 89, (array([0], dtype=int32), array([89])))
</pre></div>
</div>
</div>
</div>
<p>The deme sizes each generation must be integer values.  The simulation uses C/C++ rules for
rounding double-precision values to integer values. The function <code class="docutils literal notranslate"><span class="pre">numpy.rint</span></code> uses the same
rules:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>N0 = np.float64(50.0)
for i in range(6):
   Ni = N0 * np.power(1.1, i + 1)
   print(i + 1, Ni, np.rint(Ni))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1 55.00000000000001 55.0
2 60.50000000000001 61.0
3 66.55000000000003 67.0
4 73.20500000000003 73.0
5 80.52550000000002 81.0
6 88.57805000000005 89.0
</pre></div>
</div>
</div>
</div>
<p>You may need to keep the rounding policy in mind when trying to predict final deme sizes when testing
or when trying to convert a model from continuous time into discrete time.</p>
</section>
<section id="changing-the-selfing-rate">
<h3>Changing the selfing rate<a class="headerlink" href="#changing-the-selfing-rate" title="Permalink to this headline">#</a></h3>
<p>Instances of <a class="reference internal" href="types.html#fwdpy11.SetSelfingRate" title="fwdpy11.SetSelfingRate"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.SetSelfingRate</span></code></a> affect the rate of selfing-versus-outcrossing in different
demes, or to change the rate within a deme over time. The default is that individuals don’t self
unless they are picked twice as a parent by chance.</p>
<p>Using this type is straightforward.  Before we dive in, we will create a new recorder
type to track parents each generation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class ParentTracker(object):
    def __init__(self):
        self.data = []

    def __call__(self, pop, sampler):
        for i in pop.diploid_metadata:
            self.data.append((i.label, i.deme, i.parents))
</pre></div>
</div>
</div>
</div>
<p>Let’s run a simulation for a couple of generations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation([5, 5], 1.0)
sr = [fwdpy11.SetSelfingRate(when=0, deme=1, S=1.0)]  # Deme 1 always selfs
dd = fwdpy11.DiscreteDemography(set_selfing_rates=sr)
pt = ParentTracker()
setup_and_run_model(pop, dd, 2, pt)
</pre></div>
</div>
</div>
</div>
<p>In our output, the deme label is the second value in each tuple, and any individual
in deme 1 has the same parent listed twice because they were the product of a selfing event:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for i in pt.data:
    print(i)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0, 0, (1, 1))
(1, 0, (4, 1))
(2, 0, (0, 1))
(3, 0, (0, 4))
(4, 0, (1, 2))
(5, 1, (8, 8))
(6, 1, (9, 9))
(7, 1, (6, 6))
(8, 1, (5, 5))
(9, 1, (5, 5))
(0, 0, (0, 3))
(1, 0, (0, 2))
(2, 0, (2, 4))
(3, 0, (3, 3))
(4, 0, (0, 0))
(5, 1, (7, 7))
(6, 1, (8, 8))
(7, 1, (8, 8))
(8, 1, (5, 5))
(9, 1, (8, 8))
</pre></div>
</div>
</div>
</div>
<p>(In the above output, the parent IDs are the indexes of the parental individuals from their
generation.)</p>
</section>
<section id="migration">
<span id="id6"></span><h3>Migration<a class="headerlink" href="#migration" title="Permalink to this headline">#</a></h3>
<p>For models with multiple demes, migration between then is managed by an
instance of <a class="reference internal" href="types.html#fwdpy11.MigrationMatrix" title="fwdpy11.MigrationMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.MigrationMatrix</span></code></a>.</p>
<p>For a migration matrix <code class="docutils literal notranslate"><span class="pre">M</span></code>, the default interpretation of <code class="docutils literal notranslate"><span class="pre">M[i,</span> <span class="pre">j]</span></code> is the
fraction of deme <code class="docutils literal notranslate"><span class="pre">i</span></code> that will be replaced by migrations from deme <code class="docutils literal notranslate"><span class="pre">j</span></code>. The
entry <code class="docutils literal notranslate"><span class="pre">M[i,</span> <span class="pre">i]</span></code> represents the non-migrant fraction of deme <code class="docutils literal notranslate"><span class="pre">i</span></code>’s ancestry.
The matrix is “row-major” meaning that rows refer to migration into source demes.
This definition of the migration matrix corresponds to that found in several
different sources (<span id="id7">[<a class="reference internal" href="../misc/bibliography.html#id11" title="Freddy Bugge Christiansen. Sufficient conditions for protected polymorphism in a subdivided population. Am. Nat., 108(960):157–166, 1974. doi:10.1086/282896.">Chr74</a>]</span>, <span id="id8">[<a class="reference internal" href="../misc/bibliography.html#id12" title="Freddy Bugge Christiansen. Hard and soft selection in a subdivided population. Am. Nat., 109(965):11–16, January 1975. doi:10.1086/282970.">Chr75</a>]</span>).
This definition of migration is also what diffusion models assume (<em>e.g.</em> <span id="id9">[<a class="reference internal" href="../misc/bibliography.html#id8" title="Julien Jouganous, Will Long, Aaron P Ragsdale, and Simon Gravel. Inferring the joint demographic history of multiple populations: beyond the diffusion approximation. Genetics, 206(3):1549–1567, July 2017. doi:10.1534/genetics.117.200493.">JLRG17</a>]</span>)
as well as coalescent simulations like <em>msprime</em> <span id="id10">[<a class="reference internal" href="../misc/bibliography.html#id19" title="Jerome Kelleher, Alison M Etheridge, and Gilean McVean. Efficient coalescent simulation and genealogical analysis for large sample sizes. PLoS Comput. Biol., 12(5):e1004842, May 2016. doi:10.1371/journal.pcbi.1004842.">KEM16</a>]</span>.</p>
<p>For example, consider the following matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>m = np.array([0.9, 0.1, 0.5, 0.5]).reshape(2, 2)
m
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.9, 0.1],
       [0.5, 0.5]])
</pre></div>
</div>
</div>
</div>
<p>The first row corresponds to the ancestry of deme <code class="docutils literal notranslate"><span class="pre">0</span></code>, such that 90% of offspring will be
non-migrants and 10% will be migrants from deme <code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>m[
   0,
]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.9, 0.1])
</pre></div>
</div>
</div>
</div>
<p>To be concrete, if the size of deme <code class="docutils literal notranslate"><span class="pre">0</span></code> in the next generation is 1,000, then the expected
number of migrant and non-migrant offspring of offspring in deme <code class="docutils literal notranslate"><span class="pre">0</span></code> is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>m[
   0,
] * 1e3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([900., 100.])
</pre></div>
</div>
</div>
</div>
<p>The second row implies that half the ancestry of deme <code class="docutils literal notranslate"><span class="pre">1</span></code> is due to migrants and half
due to non-migrants:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>m[
   1,
]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.5, 0.5])
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array is sufficient to construct our demographic model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>d = fwdpy11.DiscreteDemography(migmatrix=m)
d.migmatrix
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fwdpy11.MigrationMatrix(migmatrix=array([[0.9, 0.1],
       [0.5, 0.5]]), scaled=False)
</pre></div>
</div>
</div>
</div>
<p>By default, there is no migration, which is represented by the value <code class="docutils literal notranslate"><span class="pre">None</span></code>.  For example,
the following model has no migration events:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Define demographic events w/o any migration stuff
d = fwdpy11.DiscreteDemography(set_deme_sizes=[fwdpy11.SetDemeSize(0, 1, 500)])
d.migmatrix is None
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>In order to specify a model with no initial migration, you may use an identity matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>d = fwdpy11.DiscreteDemography(migmatrix=np.identity(2))
d.migmatrix
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fwdpy11.MigrationMatrix(migmatrix=array([[1., 0.],
       [0., 1.]]), scaled=False)
</pre></div>
</div>
</div>
</div>
<p>The only reason to use the identity matrix is to start a simulation with no migration
and then change the rates later via instances of <a class="reference internal" href="types.html#fwdpy11.SetMigrationRates" title="fwdpy11.SetMigrationRates"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.SetMigrationRates</span></code></a>.
To see this in action, we’ll first generate a new type to track if parents of
offspring in deme 1 are migrants or not:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class MigrationTracker(object):
    def __init__(self, N0):
        self.N0 = N0
        self.data = []

    def __call__(self, pop, sampler):
        for i in pop.diploid_metadata:
            if i.deme == 1:
                p = []
                for j in i.parents:
                    if j &lt; self.N0:
                        p.append((j, True))
                    else:
                        p.append((j, False))
                self.data.append((pop.generation, i.label, i.deme, p))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># No migration at first
mm = np.identity(2)
# In generation 3, reset migration rates for deme 1 such
# that parents are equally likey from both demes.
cm = [fwdpy11.SetMigrationRates(3, 1, [0.5, 0.5])]
dd = fwdpy11.DiscreteDemography(migmatrix=mm, set_migration_rates=cm)
pop = fwdpy11.DiploidPopulation([10, 10], 1.0)
mt = MigrationTracker(10)
setup_and_run_model(pop, dd, 4, mt)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for i in mt.data:
    nmig = 0
    if i[1] &gt; 10:
        if i[3][0][1] is True:
                nmig += 1
        if i[3][1][1] is True:
            nmig += 1
    mstring = &quot;&quot;
    if nmig &gt; 0:
        mstring = &quot;&lt;-  migrant parent&quot;.format(nmig)
    if nmig &gt; 1:
        mstring += &quot;s&quot;
        print(i, mstring)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4, 11, 1, [(1, True), (4, True)]) &lt;-  migrant parents
(4, 12, 1, [(0, True), (7, True)]) &lt;-  migrant parents
(4, 13, 1, [(5, True), (2, True)]) &lt;-  migrant parents
(4, 14, 1, [(0, True), (6, True)]) &lt;-  migrant parents
(4, 18, 1, [(0, True), (8, True)]) &lt;-  migrant parents
</pre></div>
</div>
</div>
</div>
<section id="an-alternative-model-of-migration">
<h4>An alternative model of migration<a class="headerlink" href="#an-alternative-model-of-migration" title="Permalink to this headline">#</a></h4>
<p>The description of migration rates above implies that migration events are
independent of of source deme sizes.  To revisit our earlier example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>m = np.array([0.9, 0.1, 0.5, 0.5]).reshape(2, 2)
# The is the expected number of parents from demes 0 and 1
# to offspring born in deme 0:
m[
   0,
] * 1000
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([900., 100.])
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fwdpy11</span></code> allows for a different migration scheme where the size of the source deme
matters.  For this model, <code class="docutils literal notranslate"><span class="pre">M[i</span> <span class="pre">,j]</span></code> is the probability that an individual with parents from
deme <code class="docutils literal notranslate"><span class="pre">j</span></code> is born in deme <code class="docutils literal notranslate"><span class="pre">i</span></code>.  Internally, the migration matrix entries
<code class="docutils literal notranslate"><span class="pre">M[i,</span> <span class="pre">j]</span></code> are multiplied by the size of the <em>source</em> demes, which means that
larger demes with nonzero migration rates to other demes have a larger chance
of being sources of migrant offspring.</p>
<p>For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>deme_sizes = np.array([1000, 2000])
m
md = m * deme_sizes
# The following line divides each
# row by its sum
md / np.sum(md, axis=1)[:, None]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.81818182, 0.18181818],
       [0.33333333, 0.66666667]])
</pre></div>
</div>
</div>
</div>
<p>The first matrix is the same as in the preceding section–90% of the offspring in deme
<code class="docutils literal notranslate"><span class="pre">0</span></code> will have parents from deme <code class="docutils literal notranslate"><span class="pre">0</span></code>.  In the second matrix, that fraction is reduced to
about 82% because deme <code class="docutils literal notranslate"><span class="pre">1</span></code> is twice as large as deme <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>To enable this migration model, create an instance of <a class="reference internal" href="types.html#fwdpy11.MigrationMatrix" title="fwdpy11.MigrationMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">fwdpy11.MigrationMatrix</span></code></a> and
pass <code class="docutils literal notranslate"><span class="pre">True</span></code> as the second parameter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>M = fwdpy11.MigrationMatrix(m, True)
d = fwdpy11.DiscreteDemography(migmatrix=M)
</pre></div>
</div>
</div>
</div>
<p>This will also work, but is less explicit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>d = fwdpy11.DiscreteDemography(migmatrix=(m, True))
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This model of migration will typically give <em>different</em> results
from diffusion models and coalescent simulations!</p>
</div>
</section>
</section>
</section>
<section id="examples-of-models">
<span id="migration-and-selfing"></span><h2>Examples of models<a class="headerlink" href="#examples-of-models" title="Permalink to this headline">#</a></h2>
<section id="isolation-with-migration-or-im">
<h3>Isolation with migration, or “IM”<a class="headerlink" href="#isolation-with-migration-or-im" title="Permalink to this headline">#</a></h3>
<p>Consider two demes that split apart <code class="docutils literal notranslate"><span class="pre">T</span></code> time units ago and then grow to different
sizes in the present.  After the split, migration occurs between the two demes. The
demographic model has the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Nanc</span></code>, the ancestral population size.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T</span></code>, the time of the split, which is in units of <code class="docutils literal notranslate"><span class="pre">Nanc</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">psplit</span></code>, the proportion of the ancestral population that splits off to found deme <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">N0</span></code>, the final size of deme <code class="docutils literal notranslate"><span class="pre">0</span></code>, relative to <code class="docutils literal notranslate"><span class="pre">Nanc</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">N1</span></code>, the final size of deme <code class="docutils literal notranslate"><span class="pre">1</span></code>, relative to <code class="docutils literal notranslate"><span class="pre">Nanc</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m01</span></code>, the migration rate from deme <code class="docutils literal notranslate"><span class="pre">0</span></code> to deme <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m10</span></code>, the migration rate from deme <code class="docutils literal notranslate"><span class="pre">1</span></code> to deme <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
</ul>
<p>Here is the model in its entirety, with no mutation and no recombination.
First, we will set up the demographic events.  The population with evolve
for <code class="docutils literal notranslate"><span class="pre">Nanc</span></code> generations before the split.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>Nanc = 100
T = 0.2
psplit = 0.33
N0, N1 = 2, 3
m01, m10 = 0.01, 0.0267

# The split event
split = [fwdpy11.move_individuals(when=Nanc, source=0, destination=1, fraction=psplit)]
# Get growth rates and set growth rate changes,
# taking care to handle our rounding!
gens_post_split = np.rint(Nanc * T).astype(int)
N0split = np.rint(Nanc * (1.0 - psplit))
N0final = np.rint(N0 * Nanc)
N1split = np.rint(Nanc * psplit)
N1final = np.rint(N1 * Nanc)
G0 = fwdpy11.exponential_growth_rate(N0split, N0final, gens_post_split)
G1 = fwdpy11.exponential_growth_rate(N1split, N1final, gens_post_split)
growth = [
    fwdpy11.SetExponentialGrowth(Nanc, 0, G0),
    fwdpy11.SetExponentialGrowth(Nanc, 1, G1),
]

# Set up the migration matrix for two demes, but only
# deme zero exists.
m = fwdpy11.migration_matrix_single_extant_deme(2, 0)
# The rows of the matrix change at the split:
cm = [
    fwdpy11.SetMigrationRates(Nanc, 0, [1.0 - m10, m10]),
    fwdpy11.SetMigrationRates(Nanc, 1, [m01, 1.0 - m01]),
]
d = fwdpy11.DiscreteDemography(
    mass_migrations=split, set_growth_rates=growth, set_migration_rates=cm, migmatrix=m
)
</pre></div>
</div>
</div>
</div>
<p>The above code made use of two helper functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="functions.html#fwdpy11.exponential_growth_rate" title="fwdpy11.exponential_growth_rate"><code class="xref py py-func docutils literal notranslate"><span class="pre">fwdpy11.exponential_growth_rate()</span></code></a></p></li>
<li><p><a class="reference internal" href="functions.html#fwdpy11.migration_matrix_single_extant_deme" title="fwdpy11.migration_matrix_single_extant_deme"><code class="xref py py-func docutils literal notranslate"><span class="pre">fwdpy11.migration_matrix_single_extant_deme()</span></code></a></p></li>
</ul>
<p>Finally, we can run it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pop = fwdpy11.DiploidPopulation(Nanc, 1.0)
setup_and_run_model(pop, d, Nanc + gens_post_split)
</pre></div>
</div>
</div>
</div>
<p>Now we check the final population sizes and make sure they are correct:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ds = pop.deme_sizes()
assert ds[1][0] == N0final
assert ds[1][1] == N1final
</pre></div>
</div>
</div>
</div>
<p>This model is common enough that you shouldn’t have to implement it from
scratch each time.  For this reason, we provide it in <a class="reference internal" href="demographic_models.html#fwdpy11.demographic_models.IM.two_deme_IM" title="fwdpy11.demographic_models.IM.two_deme_IM"><code class="xref py py-func docutils literal notranslate"><span class="pre">fwdpy11.demographic_models.IM.two_deme_IM()</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import fwdpy11.demographic_models.IM

dmodel = fwdpy11.demographic_models.IM.two_deme_IM(
    Nanc, T, psplit, (N0, N1), (m01, m10), burnin=1.0
)
pop2 = fwdpy11.DiploidPopulation(Nanc, 1.0)
setup_and_run_model(pop2, dmodel.model, dmodel.metadata.simlen)
assert pop.generation == pop2.generation
assert pop2.generation == dmodel.metadata.simlen
ds2 = pop2.deme_sizes()
assert np.array_equal(ds[0], ds2[0])
assert np.array_equal(ds[1], ds2[1])
</pre></div>
</div>
</div>
</div>
<p>See <a class="reference internal" href="../examples/IM.html#imexample"><span class="std std-ref">Isolation-with-migration (IM)</span></a> for an example of using this function to compare to results
from diffusion models.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./pages"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="advancedtopics.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Advanced topics</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="mvdes.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Different effect sizes of mutations in different demes</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Kevin Thornton<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>